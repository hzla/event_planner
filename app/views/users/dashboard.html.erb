<%= content_for :header do %>
	<div class="header-pic-container">
		<%= image_tag current_user.profile_pic_url, id: 'header-right-pic' %>
			<div class="profile-tooltip">
				<%= current_user.name %><br>
				<%= link_to logout_path, class: "logout" do %>Logout<% end %></div>
			<div class="tail"></div>
	</div>
		<div class="hidden desk-text" id="cancel-form">Cancel</div>
		<%= image_tag current_user.profile_pic_url, id: 'header-left', :class => "mobile" %>
		<div class="main-logo text mobile main-header-text">INSTAGATOR</div>
		<div class="text mobile hidden whos-going">Who's Going?</div>
		<div class="desk-text-header whos-going hidden">Who's Going?</div>
<% end %>

<div id="content-container" class="welcome-dashboard generic">
	<% if @tutorial %>
		<div id="welcome-text-container" class="full-white-block">
			<%= image_tag 'instagatoricon.svg', id: "welcome-icon" %>
			<div id="welcome-text" class="medium-text">
				Welcome to Instagator, the easiest way to plan events.
			</div>
		</div>
		<%= link_to booking_info_path do %>
			<div id="create-poll" class="btn-rnd turq-btn pull-down">
				Create Poll
			</div>
		<% end %>

	<% else %>
		<% @events.each do |event| %>
			<%= link_to event.vote_url(current_user) do %>
				<% if event.owned_by?(current_user) %>
					<div class="event <%= event.html_classes(current_user) %>">
						<div class="event-line-text bold event-name <%= 'turq' if event.voted_on_by?(current_user) %>">
							<%= event.name %>
						</div>
						<div class="event-line-text">
							<%= event.time_info %>
						</div>
						<% if @event.last_log %>
							<%= @event.last_log %>
						<% else %>
							<div class="event-line-text bottom-line">
								<% if event.ongoing? %>
									<% if event.last_log %>
										<%= event.last_log %>
									<% else %>
										<span class="red"><%= event.time_left %> hours</span> to expiration
									<% end %>
								<% else %>
									<span class="green"><%= event.rsvps %> voters </span>
								<% end %>
							</div>
						<% end %>
						<div class="event-voters">
							<% if event.current_choice %>
								<span class="grey"><%= event.rsvps %> voters </span>
							<% else %>
								<span class="red"><%= event.rsvps %>/<%= event.polls.count %> Responded</span>
							<% end %>
						</div>
					</div>
				<% else %>
					<div class="event <%= event.html_classes(current_user) %>">
						<div class="event-line-text event-name">
							<span class="bold"><%= event.user.name %> invited you to</span>
						</div>
						<div class="event-line-text bold <%= 'green' if event.voted_on_by?(current_user) %>">
							<%= event.name %>
						</div>
						<div class="event-line-text">
							<%= event.time_info %>
						</div>
						<div class="event-line-text bottom-line">
							<% if event.ongoing? %>
								<% if event.last_log %>
									<%= event.last_log %>
								<% else %>
									<span class="red"><%= event.time_left %> hours</span> to expiration
								<% end %>
							<% end %>
						</div>
						<div class="event-voters">
							<% if event.voted_on_by?(current_user) %>
								<span class="green">You Voted</span>	
							<% end %>
						</div>
					</div>
				<% end %>					
			<% end %>
		<% end %>

			<div id="create-poll" class="btn-rnd turq-btn pull-down">
				Create Poll
			</div>

	<% end %>
	<div id="poll-creator" class="hidden">
		<%= form_for @event do |f| %>
			<%= f.text_field :name, placeholder: "Poll Name", :class => "poll-field" %>
			<div id="datepair">
				<% if browser.mobile? %>
					<%= f.date_field :start_date, :class => "poll-field", placeholder: "Reservation Date" %>
					<div data-role="rangeslider">
					  <label for="range-1a">Rangeslider:</label>
					  <input name="range-1a" id="range-1a" min="0" max="100" value="0" type="range" />
					  <label for="range-1b">Rangeslider:</label>
					  <input name="range-1b" id="range-1b" min="0" max="100" value="100" type="range" />
					</div>
				<% else %>
					<%= f.text_field :start_date, :class => "pick-date poll-field", placeholder: "Reservation Date" %>
					<%= f.text_field :start_time, :class => "pick-time poll-field hidden", placeholder: "Earliest Time" %>
					<%= f.text_field :end_time, :class => "pick-time poll-field hidden", placeholder: "Latest Time" %>
					<div id="event-timepicker">
						<div id="timepicker-header">What time range should we try to book in?</div>
						<div id="slider-range"></div>
						<div id="time-range"></div>
					</div>
				<% end %>
			</div>
			<%= f.select :threshold, options_for_select((2..16).to_a), prompt: "Minimum Party Size", :class => "poll-field" %>
			<%= f.submit "Continue", id: "submit-poll", :class => "btn blue-btn" %>
		<% end %>
		<% if @tutorial %>

		<% end %>
	</div>
</div>




<script>
	$(document).on("pagecreate", "#page1", function(){       
	    $("#sliderTime").on("change", function(){
	        var time = IntToTime($(this).val());
	        $("#theTime .timeLabel").val(time);
	        $("#theTime .ui-slider-handle").prop("title", time);
	    });    
	});

	function IntToTime(val){
	    var hours = parseInt( val / 60 );
	    var min = val - (hours * 60);
	    var time = hours + ':' + (min < 10 ? '0' + min : min);
	    return time;
	}


	 Date.prototype.yyyymmdd = function() {
	   var yyyy = this.getFullYear().toString();
	   var mm = (this.getMonth()+1).toString(); // getMonth() is zero-based
	   var dd  = this.getDate().toString();
	   return yyyy + "-" + (mm[1]?mm:"0"+mm[0]) + "-" + (dd[1]?dd:"0"+dd[0]); // padding
	  };
	  var d = new Date();
		

	$("#slider-range").slider({
		  from: 480,
		  to: 1020,
		  step: 15,
		  dimension: '',
		  scale: ['8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
		  limits: false,
		  calculate: function( value ){
		    var hours = Math.floor( value / 60 );
		    var mins = ( value - hours*60 );
		    return (hours < 10 ? "0"+hours : hours) + ":" + ( mins == 0 ? "00" : mins );
		  },
		  onstatechange: slideTime
		});
  function slideTime(event, ui){
	    var val0 = $("#slider-range").slider("values", 0),
	        val1 = $("#slider-range").slider("values", 1),
	        minutes0 = parseInt(val0 % 60, 10),
	        hours0 = parseInt(val0 / 60 % 24, 10),
	        minutes1 = parseInt(val1 % 60, 10),
	        hours1 = parseInt(val1 / 60 % 24, 10);
	    startTime = getTime(hours0, minutes0);
	    endTime = getTime(hours1, minutes1);
	    $("#time-range").text(startTime + ' - ' + endTime);
	    $('#event_start_time').val(startTime)
	    $('#event_end_time').val(endTime)
	}
	function getTime(hours, minutes) {
    var time = null;
    minutes = minutes + "";
    if (hours < 12) {
        time = "AM";
    }
    else {
        time = "PM";
    }
    if (hours == 0) {
        hours = 12;
    }
    if (hours > 12) {
        hours = hours - 12;
    }
    if (minutes.length == 1) {
        minutes = "0" + minutes;
    }
    return hours + ":" + minutes + " " + time;
	}
	slideTime();
	$('.pick-date').datepicker({
      'format': 'yyyy-m-d',
      'autoclose': true,
      'startDate': d.yyyymmdd()
    });
</script>

